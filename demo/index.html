<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>完整示例-AlistUploaderJS</title>
    <!-- CDN引入 -->
    <script src="https://testingcf.jsdelivr.net/gh/4444TENSEI/AlistUploaderJS@v0.1.1/npm/alist-uploader.js"></script>
  </head>

  <body>
    <details>
      <summary>这是一个完整示例, 展开提示</summary>
      这个示例包含了上传、进度条展示、取消上传、清空上传列表。要查看上传具体状态,
      请配置代码中的alistUploaderOptions变量包含"debug: true"后, 查看F12控制台。
    </details>

    <input type="file" id="fileInput" multiple />
    <button type="button" onclick="uploadFiles()">上传</button>
    <button type="button" onclick="cancelUpload()">取消上传</button>
    <button type="button" onclick="clearProgress()">清空列表</button>

    <p>上传进度</p>
    <div id="progressContainer"></div>

    <script>
      // 配置Alist上传器
      const alistUploaderOptions = new AlistUploader({
        // [必须]你的Alist服务地址
        baseUrl: "https://alist.example.com",
        // [必须]Alist账号
        username: "admin",
        // [必须]Alist密码
        password: "123456",
        // [必须]上传到哪个目录，例如要传到"https://alist.example.com/webdav"，则照下方填写
        uploadRootFolder: "webdav",

        // [可选]上传并发数量, 默认值为 1。
        concurrency: 3,
        // [可选]为每次上传自动创建以时间命名(14位数字)的文件夹, 默认值为 false。
        createTimestampFolder: true,
        // [可选]控制台调试开关, 默认值为 false。
        debug: true,
        // [可选]版本号信息输出开关, 默认值为 true
        showVersionInfo: true,
        // [可选]上传类型, 默认值为 "stream"也就是流式传输, 也可设置为"form"表单方式。
        uploadMethod: "stream",
      });

      // 上传进度展示
      function updateProgress(fileProgress) {
        const progressContainer = document.getElementById("progressContainer");
        progressContainer.innerHTML = "";
        Object.keys(fileProgress).forEach((filename) => {
          const fileInfo = fileProgress[filename];
          const progressElement = document.createElement("div");

          // 创建进度条
          const progressBar = document.createElement("progress");
          progressBar.max = 100;
          progressBar.value = fileInfo.progress;

          // 上传进度
          const progressLabel = document.createElement("span");
          progressLabel.textContent = `${filename}:${fileInfo.progressText}`;

          // 文件大小
          const fileSizeLabel = document.createElement("span");
          fileSizeLabel.textContent = ` | 文件大小: ${fileInfo.fileSize}`;

          // 上传速度
          const speedLabel = document.createElement("span");
          speedLabel.textContent = ` | 平均速度: ${fileInfo.uploadSpeed}`;

          // 已用时间
          const timeDiffLabel = document.createElement("span");
          timeDiffLabel.textContent = ` | 已用时间: ${fileInfo.timeDiff} 秒`;

          // 剩余时间
          const remainingTimeLabel = document.createElement("span");
          remainingTimeLabel.textContent = ` | 剩余时间: ${fileInfo.remainingTime} 秒`;

          progressElement.appendChild(progressLabel);
          progressElement.appendChild(progressBar);
          progressElement.appendChild(fileSizeLabel);
          progressElement.appendChild(speedLabel);
          progressElement.appendChild(remainingTimeLabel);
          progressElement.appendChild(timeDiffLabel);
          progressContainer.appendChild(progressElement);
          progressContainer.appendChild(document.createElement("br")); // 添加换行
        });
      }

      // 上传按钮
      function uploadFiles() {
        const files = document.getElementById("fileInput").files;
        alistUploaderOptions.on("progress", updateProgress);
        alistUploaderOptions.on("complete", (allSuccess) => {
          alert(allSuccess ? "所有文件上传完成！" : "某些文件上传失败。");
        });
        alistUploaderOptions.uploadFiles(files).catch((error) => {
          console.error("上传出错:", error);
        });
      }

      // 清空列表
      function clearProgress() {
        const progressContainer = document.getElementById("progressContainer");
        progressContainer.innerHTML = "";
      }

      // 取消上传
      function cancelUpload() {
        alistUploaderOptions.abortUpload();
        clearProgress();
      }
    </script>
  </body>
</html>
